<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>class/DomResize.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="AxiosRace.html">AxiosRace</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="DomResize.html">DomResize</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Event.html">Event</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="LoadImg.html">LoadImg</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="RandomSeed.html">RandomSeed</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Slide.html">Slide</a></span></li><li class="nav-heading">Modules</li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-ast.html">ast</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ast.html#.generateElementUniqueFlag">generateElementUniqueFlag</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-ast.html#.getExpression">getExpression</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-color.html">color</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-color.html#.darkenColor">darkenColor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-color.html#.HexToRgb">HexToRgb</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-color.html#.lightnessColor">lightnessColor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-color.html#.RgbToHex">RgbToHex</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-color.html#.toRgba">toRgba</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-common.html">common</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-common.html#.countMaxDuplicateNumber">countMaxDuplicateNumber</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-common.html#.curry">curry</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-common.html#.promiseOrder">promiseOrder</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-common.html#.throttle">throttle</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-date.html">date</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-date.html#.countMaxConsecutiveDate">countMaxConsecutiveDate</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-date.html#.dateFormatter">dateFormatter</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-date.html#.getMonthDays">getMonthDays</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-date.html#.getPeriod">getPeriod</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-date.html#.isEqualDate">isEqualDate</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-date.html#.isEqualDateFuzzy">isEqualDateFuzzy</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-date.html#.isLeapYear">isLeapYear</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-date.html#.isValidDate">isValidDate</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-date.html#.toDate">toDate</a></span></li><li class="nav-heading"><span class="nav-item-type type-module">M</span><span class="nav-item-name"><a href="module-html.html">html</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-html.html#.blobToDataURL">blobToDataURL</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-html.html#.canvasToImg">canvasToImg</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-html.html#.checkNodeCanScroll">checkNodeCanScroll</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-html.html#.checkPageCanScroll">checkPageCanScroll</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-html.html#.cutText">cutText</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-html.html#.dataURLToBlob">dataURLToBlob</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-html.html#.downloadImg">downloadImg</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-html.html#.getPixelRatio">getPixelRatio</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-html.html#.hiddenRows">hiddenRows</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-html.html#.HTMLDecode">HTMLDecode</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-html.html#.HTMLEncode">HTMLEncode</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-html.html#.infiniteScroll">infiniteScroll</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-html.html#.insertScripts">insertScripts</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="module-html.html#.urlToDataURL">urlToDataURL</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">class/DomResize.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import { Event } from './Event'

/**
 * @description 节点大小监测。
 * @example
 * // 使用
 * let event = new DomResize(document.querySelector('#contianer'))
 * event.on('dom-resize', callback)
 */

export class DomResize extends Event {
  width = 20000
  oldWidth = 0
  newWidth = 0
  oldHeight = 0
  newHeight = 0
  supportsPassive = false
  constructor (el) {
      super()
      this.el = el
      this._init()
  }
  _init () {
      this.oldWidth = parseFloat(window.getComputedStyle(this.el).width)
      this.oldHeight = parseFloat(window.getComputedStyle(this.el).height)
      this.setSupportsPassive()
      this.createNode()
  }

  createNode () {
      // 监听变大的DOM
      const holderBig = document.createElement('div')

      holderBig.style =
      'position: absolute;top:0;left: 0;bottom: 0;right: 0;overflow: hidden;visibility: hidden;z-index:-1'
      holderBig.innerHTML = `&lt;div style="width:${this.width}px;height:${this.width}px">&lt;/div>`

      // 监听变小的DOM
      const holderSmall = document.createElement('div')

      holderSmall.style =
      'position: absolute;top:0;left: 0;bottom: 0;right: 0;overflow: hidden;visibility: hidden;z-index:-1'
      holderSmall.innerHTML = '&lt;div style="width:300%;height:300%">&lt;/div>'

      this.holderBig = holderBig
      this.holderSmall = holderSmall
      this.el.appendChild(holderBig)
      this.el.appendChild(holderSmall)

      holderSmall.scrollTop = this.width
      holderSmall.scrollLeft = this.width
      holderBig.scrollTop = this.width
      holderBig.scrollLeft = this.width

      holderBig.addEventListener(
          'scroll',
          this.scroll,
          this.supportsPassive
              ? {
                  passive: true
              }
              : false,
          false
      )
      holderSmall.addEventListener(
          'scroll',
          this.scroll,
          this.supportsPassive
              ? {
                  passive: true
              }
              : false,
          false
      )
  }

  scroll = () => {
      this.newWidth = parseFloat(window.getComputedStyle(this.el).width)
      this.newHeight = parseFloat(window.getComputedStyle(this.el).height)
      // 只有两次width不同时才分发事件，不然会多次分发
      if (this.oldWidth !== this.newWidth || this.oldHeight !== this.newHeight) {
          this.emit('dom-resize')
          this.oldWidth = this.newWidth
          this.oldHeight = this.newHeight
      }
      // 每次触发滚动事件后，重新将滚动条设至尽头
      this.holderSmall.scrollTop = this.holderBig.scrollTop = this.width
      this.holderSmall.scrollLeft = this.holderBig.scrollLeft = this.width
  }

  setSupportsPassive () {
      try {
          const opts = Object.defineProperty({}, 'passive', {
              get: () => {
                  this.supportsPassive = true
                  return true
              }
          })

          window.addEventListener('testPassive', null, opts)
          window.removeEventListener('testPassive', null, opts)
      } catch (e) {
          console.error(e)
      }
  }

  destroy () {
      this.holderBig.removeEventListener('scroll', this.scroll)
      this.holderSmall.removeEventListener('scroll', this.scroll)
      this.el.removeChild(this.holderBig)
      this.el.removeChild(this.holderSmall)
  }
}

</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.4</a> on Wed Sep 15 2021 12:22:46 GMT+0800 (中国标准时间) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
